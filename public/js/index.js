!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){"use strict";function Microphone(_options){var options=_options||{};this.bufferSize=options.bufferSize||8192,this.inputChannels=options.inputChannels||1,this.outputChannels=options.outputChannels||1,this.recording=!1,this.requestedAccess=!1,this.sampleRate=16e3,this.bufferUnusedSamples=new Float32Array(0),this.samplesAll=new Float32Array(2e7),this.samplesAllOffset=0,navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}var utils=require("./utils");Microphone.prototype.onPermissionRejected=function(){console.log("Microphone.onPermissionRejected()"),this.requestedAccess=!1,this.onError("Permission to access the microphone rejeted.")},Microphone.prototype.onError=function(error){console.log("Microphone.onError():",error)},Microphone.prototype.onMediaStream=function(stream){var AudioCtx=window.AudioContext||window.webkitAudioContext;if(!AudioCtx)throw new Error("AudioContext not available");this.audioContext||(this.audioContext=new AudioCtx);var gain=this.audioContext.createGain(),audioInput=this.audioContext.createMediaStreamSource(stream);audioInput.connect(gain),this.mic||(this.mic=this.audioContext.createScriptProcessor(this.bufferSize,this.inputChannels,this.outputChannels)),console.log("Microphone.onMediaStream(): sampling rate is:",this.sampleRate),this.mic.onaudioprocess=this._onaudioprocess.bind(this),this.stream=stream,gain.connect(this.mic),this.mic.connect(this.audioContext.destination),this.recording=!0,this.requestedAccess=!1,this.onStartRecording()},Microphone.prototype._onaudioprocess=function(data){if(this.recording){var chan=data.inputBuffer.getChannelData(0);this.saveData(new Float32Array(chan)),this.onAudio(this._exportDataBufferTo16Khz(new Float32Array(chan)))}},Microphone.prototype.record=function(){return navigator.getUserMedia?void(this.requestedAccess||(this.requestedAccess=!0,navigator.getUserMedia({audio:!0},this.onMediaStream.bind(this),this.onPermissionRejected.bind(this)))):void this.onError("Browser doesn't support microphone input")},Microphone.prototype.stop=function(){this.recording&&(JSON.parse(localStorage.getItem("playback"))&&this.playWav(),this.recording=!1,this.stream.getTracks()[0].stop(),this.requestedAccess=!1,this.mic.disconnect(0),this.onStopRecording())},Microphone.prototype._exportDataBufferTo16Khz=function(bufferNewSamples){var buffer=null,newSamples=bufferNewSamples.length,unusedSamples=this.bufferUnusedSamples.length;if(unusedSamples>0){buffer=new Float32Array(unusedSamples+newSamples);for(var i=0;unusedSamples>i;++i)buffer[i]=this.bufferUnusedSamples[i];for(i=0;newSamples>i;++i)buffer[unusedSamples+i]=bufferNewSamples[i]}else buffer=bufferNewSamples;for(var filter=[-.037935,-89024e-8,.040173,.019989,.0047792,-.058675,-.056487,-.0040653,.14527,.26927,.33913,.26927,.14527,-.0040653,-.056487,-.058675,.0047792,.019989,.040173,-89024e-8,-.037935],samplingRateRatio=this.audioContext.sampleRate/16e3,nOutputSamples=Math.floor((buffer.length-filter.length)/samplingRateRatio)+1,pcmEncodedBuffer16k=new ArrayBuffer(2*nOutputSamples),dataView16k=new DataView(pcmEncodedBuffer16k),index=0,volume=32767,nOut=0,i=0;i+filter.length-1<buffer.length;i=Math.round(samplingRateRatio*nOut)){for(var sample=0,j=0;j<filter.length;++j)sample+=buffer[i+j]*filter[j];sample*=volume,dataView16k.setInt16(index,sample,!0),index+=2,nOut++}var indexSampleAfterLastUsed=Math.round(samplingRateRatio*nOut),remaining=buffer.length-indexSampleAfterLastUsed;if(remaining>0)for(this.bufferUnusedSamples=new Float32Array(remaining),i=0;remaining>i;++i)this.bufferUnusedSamples[i]=buffer[indexSampleAfterLastUsed+i];else this.bufferUnusedSamples=new Float32Array(0);return new Blob([dataView16k],{type:"audio/l16"})};Microphone.prototype._exportDataBuffer=function(buffer){utils.exportDataBuffer(buffer,this.bufferSize)},Microphone.prototype.onStartRecording=function(){},Microphone.prototype.onStopRecording=function(){},Microphone.prototype.onAudio=function(){},module.exports=Microphone,Microphone.prototype.saveData=function(samples){for(var i=0;i<samples.length;++i)this.samplesAll[this.samplesAllOffset+i]=samples[i];this.samplesAllOffset+=samples.length,console.log("samples: "+this.samplesAllOffset)},Microphone.prototype.playWav=function(){var samples=this.samplesAll.subarray(0,this.samplesAllOffset),dataview=this.encodeWav(samples,1,this.audioContext.sampleRate),audioBlob=new Blob([dataview],{type:"audio/l16"}),url=window.URL.createObjectURL(audioBlob),audio=new Audio;audio.src=url,audio.play()},Microphone.prototype.encodeWav=function(samples,numChannels,sampleRate){console.log("#samples: "+samples.length);var buffer=new ArrayBuffer(44+2*samples.length),view=new DataView(buffer);return this.writeString(view,0,"RIFF"),view.setUint32(4,36+2*samples.length,!0),this.writeString(view,8,"WAVE"),this.writeString(view,12,"fmt "),view.setUint32(16,16,!0),view.setUint16(20,1,!0),view.setUint16(22,numChannels,!0),view.setUint32(24,sampleRate,!0),view.setUint32(28,4*sampleRate,!0),view.setUint16(32,2*numChannels,!0),view.setUint16(34,16,!0),this.writeString(view,36,"data"),view.setUint32(40,2*samples.length,!0),this.floatTo16BitPCM(view,44,samples),view},Microphone.prototype.writeString=function(view,offset,string){for(var i=0;i<string.length;i++)view.setUint8(offset+i,string.charCodeAt(i))},Microphone.prototype.floatTo16BitPCM=function(output,offset,input){for(var i=0;i<input.length;i++,offset+=2){var s=Math.max(-1,Math.min(1,input[i]));output.setInt16(offset,0>s?32768*s:32767*s,!0)}}},{"./utils":8}],2:[function(require,module){module.exports={models:[{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/ar-AR_BroadbandModel",rate:16e3,name:"ar-AR_BroadbandModel",language:"ar-AR",description:"Modern Standard Arabic broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-UK_BroadbandModel",rate:16e3,name:"en-UK_BroadbandModel",language:"en-UK",description:"UK English broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-UK_NarrowbandModel",rate:8e3,name:"en-UK_NarrowbandModel",language:"en-UK",description:"UK English narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-US_BroadbandModel",rate:16e3,name:"en-US_BroadbandModel",language:"en-US",description:"US English broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-US_NarrowbandModel",rate:8e3,name:"en-US_NarrowbandModel",language:"en-US",description:"US English narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/es-ES_BroadbandModel",rate:16e3,name:"es-ES_BroadbandModel",language:"es-ES",description:"Spanish broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/es-ES_NarrowbandModel",rate:8e3,name:"es-ES_NarrowbandModel",language:"es-ES",description:"Spanish narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/ja-JP_BroadbandModel",rate:16e3,name:"ja-JP_BroadbandModel",language:"ja-JP",description:"Japanese broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/ja-JP_NarrowbandModel",rate:8e3,name:"ja-JP_NarrowbandModel",language:"ja-JP",description:"Japanese narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/pt-BR_BroadbandModel",rate:16e3,name:"pt-BR_BroadbandModel",language:"pt-BR",description:"Brazilian Portuguese broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/pt-BR_NarrowbandModel",rate:8e3,name:"pt-BR_NarrowbandModel",language:"pt-BR",description:"Brazilian Portuguese narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/zh-CN_BroadbandModel",rate:16e3,name:"zh-CN_BroadbandModel",language:"zh-CN",description:"Mandarin broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/zh-CN_NarrowbandModel",rate:8e3,name:"zh-CN_NarrowbandModel",language:"zh-CN",description:"Mandarin narrowband model."}]}},{}],3:[function(require,module,exports){"use strict";var display=require("./views/displaymetadata"),initSocket=require("./socket").initSocket;exports.handleFileUpload=function(type,token,model,file,contentType,callback,onend){function onOpen(){console.log("Socket opened")}function onListening(socket){console.log("Socket listening"),callback(socket)}function onMessage(msg){msg.results&&(baseString=display.showResult(msg,baseString,model),baseJSON=JSON.stringify(msg,null,2),display.showJSON(baseJSON))}function onError(evt){localStorage.setItem("currentlyDisplaying","false"),onend(evt),console.log("Socket err: ",evt.code)}function onClose(evt){localStorage.setItem("currentlyDisplaying","false"),onend(evt),console.log("Socket closing: ",evt)}localStorage.setItem("currentlyDisplaying",type),$.subscribe("progress",function(evt,data){console.log("progress: ",data)}),console.log("contentType",contentType);var baseString="",baseJSON="";$.subscribe("showjson",function(){var $resultsJSON=$("#resultsJSON");$resultsJSON.val(baseJSON)});var keywords=display.getKeywordsToSearch(),keywords_threshold=0==keywords.length?null:.01,options={};options.token=token,options.message={action:"start","content-type":contentType,interim_results:!0,continuous:!0,word_confidence:!0,timestamps:!0,max_alternatives:3,inactivity_timeout:600,word_alternatives_threshold:.001,keywords_threshold:keywords_threshold,keywords:keywords},options.model=model,initSocket(options,onOpen,onListening,onMessage,onError,onClose)}},{"./socket":7,"./views/displaymetadata":10}],4:[function(require,module,exports){"use strict";var initSocket=require("./socket").initSocket,display=require("./views/displaymetadata");exports.handleMicrophone=function(token,model,mic,callback){function onOpen(socket){console.log("Mic socket: opened"),callback(null,socket)}function onListening(socket){mic.onAudio=function(blob){socket.readyState<2&&socket.send(blob)}}function onMessage(msg){msg.results&&(baseString=display.showResult(msg,baseString,model),baseJSON=JSON.stringify(msg,null,2),display.showJSON(baseJSON))}function onError(){console.log("Mic socket err: ",err)}function onClose(evt){console.log("Mic socket close: ",evt)}if(model.indexOf("Narrowband")>-1){var err=new Error("Microphone transcription cannot accomodate narrowband models, please select another");return callback(err,null),!1}$.publish("clearscreen");var baseString="",baseJSON="";$.subscribe("showjson",function(){var $resultsJSON=$("#resultsJSON");$resultsJSON.val(baseJSON)});var keywords=display.getKeywordsToSearch(),keywords_threshold=0==keywords.length?null:.01,options={};options.token=token,options.message={action:"start","content-type":"audio/l16;rate=16000",interim_results:!0,continuous:!0,word_confidence:!0,timestamps:!0,max_alternatives:3,inactivity_timeout:600,word_alternatives_threshold:.001,keywords_threshold:keywords_threshold,keywords:keywords},options.model=model,initSocket(options,onOpen,onListening,onMessage,onError,onClose)}},{"./socket":7,"./views/displaymetadata":10}],5:[function(require){"use strict";var models=require("./data/models.json").models,utils=require("./utils");utils.initPubSub();var initViews=require("./views").initViews,showerror=require("./views/showerror"),showError=showerror.showError,getModels=require("./models").getModels;window.BUFFERSIZE=8192,$(document).ready(function(){var tokenGenerator=utils.createTokenGenerator();tokenGenerator.getToken(function(err,token){window.onbeforeunload=function(){localStorage.clear()},token||(console.error("No authorization token available"),console.error("Attempting to reconnect..."),showError(err&&err.code?"Server error "+err.code+": "+err.error:"Server error "+err.code+": please refresh your browser and try again"));var viewContext={currentModel:"en-US_BroadbandModel",models:models,token:token,bufferSize:BUFFERSIZE};initViews(viewContext),localStorage.setItem("models",JSON.stringify(models)),localStorage.setItem("playbackON",!1);for(var query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");"debug"===decodeURIComponent(pair[0])&&localStorage.setItem("playbackON",decodeURIComponent(pair[1]))}localStorage.setItem("currentModel","en-US_BroadbandModel"),localStorage.setItem("sessionPermissions","true"),getModels(token),$.subscribe("clearscreen",function(){$("#resultsText").text(""),$("#resultsJSON").text(""),$(".error-row").hide(),$(".notification-row").hide(),$(".hypotheses > ul").empty(),$("#metadataTableBody").empty()})})})},{"./data/models.json":2,"./models":6,"./utils":8,"./views":14,"./views/showerror":18}],6:[function(require,module,exports){"use strict";var selectModel=require("./views/selectmodel").initSelectModel;exports.getModels=function(token){var viewContext={currentModel:"en-US_BroadbandModel",models:null,token:token,bufferSize:BUFFERSIZE},modelUrl="https://stream.watsonplatform.net/speech-to-text/api/v1/models",sttRequest=new XMLHttpRequest;sttRequest.open("GET",modelUrl,!0),sttRequest.withCredentials=!0,sttRequest.setRequestHeader("Accept","application/json"),sttRequest.setRequestHeader("X-Watson-Authorization-Token",token),sttRequest.onload=function(){var response=JSON.parse(sttRequest.responseText),sorted=response.models.sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0});response.models=sorted,localStorage.setItem("models",JSON.stringify(response.models)),viewContext.models=response.models,selectModel(viewContext)},sttRequest.onerror=function(){viewContext.models=require("./data/models.json").models,selectModel(viewContext)},sttRequest.send()}},{"./data/models.json":2,"./views/selectmodel":17}],7:[function(require,module,exports){"use strict";var utils=require("./utils"),showerror=require("./views/showerror"),showError=showerror.showError,tokenGenerator=utils.createTokenGenerator(),initSocket=exports.initSocket=function(options,onopen,onlistening,onmessage,onerror,onclose){function withDefault(val,defaultVal){return"undefined"==typeof val?defaultVal:val}var listening,socket,token=options.token,model=options.model||localStorage.getItem("currentModel"),message=options.message||{action:"start"},url=(withDefault(options.sessionPermissions,JSON.parse(localStorage.getItem("sessionPermissions"))),options.serviceURI||"wss://stream.watsonplatform.net/speech-to-text/api/v1/recognize?watson-token=");url+=token+"&model="+model,console.log("URL model",model);try{socket=new WebSocket(url)}catch(err){console.error("WS connection error: ",err)}socket.onopen=function(){listening=!1,$.subscribe("hardsocketstop",function(){console.log("MICROPHONE: close."),socket.send(JSON.stringify({action:"stop"})),socket.close()}),$.subscribe("socketstop",function(){console.log("MICROPHONE: close."),socket.close()}),socket.send(JSON.stringify(message)),onopen(socket)},socket.onmessage=function(evt){var msg=JSON.parse(evt.data);return msg.error?(showError(msg.error),void $.publish("hardsocketstop")):("listening"===msg.state&&(listening?(console.log("MICROPHONE: Closing socket."),socket.close()):(onlistening(socket),listening=!0)),void onmessage(msg,socket))},socket.onerror=function(evt){console.log("WS onerror: ",evt),showError("Application error "+evt.code+": please refresh your browser and try again"),$.publish("clearscreen"),onerror(evt)},socket.onclose=function(evt){if(console.log("WS onclose: ",evt),1006===evt.code){if(console.log("generator count",tokenGenerator.getCount()),tokenGenerator.getCount()>1)throw $.publish("hardsocketstop"),new Error("No authorization token is currently available");return tokenGenerator.getToken(function(err,token){return err?($.publish("hardsocketstop"),!1):(console.log("Fetching additional token..."),options.token=token,void initSocket(options,onopen,onlistening,onmessage,onerror,onclose))}),!1}return 1011===evt.code?(console.error("Server error "+evt.code+": please refresh your browser and try again"),!1):evt.code>1e3?(console.error("Server error "+evt.code+": please refresh your browser and try again"),!1):($.unsubscribe("hardsocketstop"),$.unsubscribe("socketstop"),void onclose(evt))}}},{"./utils":8,"./views/showerror":18}],8:[function(require,module,exports){(function(global){"use strict";var $="undefined"!=typeof window?window.jQuery:"undefined"!=typeof global?global.jQuery:null,fileBlock=function(_offset,length,_file,readChunk){var r=new FileReader,blob=_file.slice(_offset,length+_offset);r.onload=readChunk,r.readAsArrayBuffer(blob)};exports.onFileProgress=function(options,ondata,running,onerror,onend,samplingRate){var file=options.file,fileSize=file.size,chunkSize=options.bufferSize||16e3,offset=0,readChunk=function(evt){if(offset>=fileSize)return console.log("Done reading file"),void onend();if(running()){if(null!=evt.target.error){var errorMessage=evt.target.error;return console.log("Read error: "+errorMessage),void onerror(errorMessage)}var buffer=evt.target.result,len=buffer.byteLength;offset+=len,ondata(buffer),samplingRate?setTimeout(function(){fileBlock(offset,chunkSize,file,readChunk)},1e3*chunkSize/(2*samplingRate)):fileBlock(offset,chunkSize,file,readChunk)}};fileBlock(offset,chunkSize,file,readChunk)},exports.createTokenGenerator=function(){var hasBeenRunTimes=0;return{getToken:function(callback){if(++hasBeenRunTimes,hasBeenRunTimes>5){var err=new Error("Cannot reach server");return void callback(null,err)}var url="/api/token",tokenRequest=new XMLHttpRequest;tokenRequest.open("POST",url,!0),tokenRequest.setRequestHeader("csrf-token",$('meta[name="ct"]').attr("content")),tokenRequest.onreadystatechange=function(){if(4===tokenRequest.readyState)if(200===tokenRequest.status){var token=tokenRequest.responseText;callback(null,token)}else{var error="Cannot reach server";if(tokenRequest.responseText)try{error=JSON.parse(tokenRequest.responseText)}catch(e){error=tokenRequest.responseText}callback(error)}},tokenRequest.send()},getCount:function(){return hasBeenRunTimes}}},exports.initPubSub=function(){var o=$({});$.subscribe=o.on.bind(o),$.unsubscribe=o.off.bind(o),$.publish=o.trigger.bind(o)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(require,module,exports){"use strict";exports.initAnimatePanel=function(){$(".panel-heading span.clickable").on("click",function(){$(this).hasClass("panel-collapsed")?($(this).parents(".panel").find(".panel-body").slideDown(),$(this).removeClass("panel-collapsed"),$(this).find("i").removeClass("caret-down").addClass("caret-up")):($(this).parents(".panel").find(".panel-body").slideUp(),$(this).addClass("panel-collapsed"),$(this).find("i").removeClass("caret-up").addClass("caret-down"))})}},{}],10:[function(require,module,exports){"use strict";function parseAlternative(element){var confidence=element.confidence,word=element.word,bin=scene._bins[scene._bins.length-1];bin.addWordAlternative(new WordAlternative(word,confidence))}function parseBin(element){var start_time=element.start_time,end_time=element.end_time,alternatives=element.alternatives,bin=new Bin(start_time,end_time);scene.addBin(bin),alternatives.forEach(parseAlternative)}function draw(){ctx.clearRect(0,0,970,370),scene.draw()}function onHScroll(){0==hslider.value?(leftArrowEnabled=!1,rightArrowEnabled=!0,$("#left-arrow").attr("src","images/arrow-left-icon-disabled.svg"),$("#left-arrow").css("background-color","transparent"),$("#right-arrow").attr("src","images/arrow-right-icon.svg"),$("#right-arrow").css("background-color","#C7C7C7")):hslider.value==Math.floor(hslider.max)?(leftArrowEnabled=!0,rightArrowEnabled=!1,$("#left-arrow").attr("src","images/arrow-left-icon.svg"),$("#left-arrow").css("background-color","#C7C7C7"),$("#right-arrow").attr("src","images/arrow-right-icon-disabled.svg"),$("#right-arrow").css("background-color","transparent")):(leftArrowEnabled=!0,rightArrowEnabled=!0,$("#left-arrow").attr("src","images/arrow-left-icon.svg"),$("#left-arrow").css("background-color","#C7C7C7"),$("#right-arrow").attr("src","images/arrow-right-icon.svg"),$("#right-arrow").css("background-color","#C7C7C7")),scene._offset_X=INITIAL_OFFSET_X-hslider.value,draw()}function onVScroll(){scene._offset_Y=INITIAL_OFFSET_Y+Number(vslider.value),draw()}function clearScene(){scene._bins=[],scene._width=0,scene._height=0,scene._offset_X=INITIAL_OFFSET_X,scene._offset_Y=INITIAL_OFFSET_Y,hslider.max=0,hslider.value=hslider.max,vslider.max=0,vslider.min=0,vslider.value=vslider.max,$("#hslider").css("display","none"),$("#vslider").css("display","none"),$("#show_alternate_words").css("display","none"),$("#canvas").css("display","none"),$("#canvas-placeholder").css("display","block"),$("#left-arrow").css("display","none"),$("#right-arrow").css("display","none"),showAllHypotheses=!0,$("#show_alternate_words").text("Hide alternate words"),ctx.clearRect(0,0,canvas.width,canvas.height)}function clearDetectedKeywords(){$("#keywords ul").empty(),detected_keywords={}}function keywordNotFound(keyword){var $li_kwd=$("<li class='keyword_no_occurrences'/>");$li_kwd.append(document.createTextNode(keyword)),$("#keywords ul").append($li_kwd)}function addKeywordToSearch(element){var keyword=element.trim();0!=keyword.length&&-1==keywords_to_search.indexOf(keyword)&&keywords_to_search.push(keyword)}function toggleSpottedKeywordClass(node){"keyword_collapsed"==node.className?(node.getElementsByClassName("keyword_icon")[0].src="images/close-icon.svg",node.className="keyword_expanded"):"keyword_expanded"==node.className&&(node.getElementsByClassName("keyword_icon")[0].src="images/open-icon.svg",node.className="keyword_collapsed")}function parseKeywords(keywords_result){for(var keyword in keywords_result){var arr=keywords_result[keyword];0!=arr.length&&(keyword in detected_keywords==0&&(detected_keywords[keyword]=[]),detected_keywords[keyword]=detected_keywords[keyword].concat(arr))}}function unselectLastKeyword(){for(var binIndex=0;binIndex<scene._bins.length;binIndex++)for(var bin=scene._bins[binIndex],wordAlternatives=bin._wordAlternatives,waIndex=0;waIndex<wordAlternatives.length;waIndex++){var wordAlternative=wordAlternatives[waIndex];wordAlternative.unselect()}}function keywordToHashSet(normalized_text){for(var hashSet={},segments=normalized_text.split(" "),index=0;index<segments.length;index++){var segment=segments[index];hashSet[segment]=!0}return hashSet}function updateKeyword(keyword){var arr=detected_keywords[keyword],arrlen=arr.length,$li=$("<li class='keyword_collapsed'/>"),$keyword_text=$("<span class='keyword_text'><img class='keyword_icon' src='images/open-icon.svg'>"+keyword+"</span>"),$keyword_count=$("<span class='keyword_count'>("+arrlen+")</span>");$li.append($keyword_text),$li.append($keyword_count);for(var $table=$("<table class='kws_occurrences'/>"),index=0;arrlen>index;index++){for(var kwd_occurrence=arr[index],start_time=kwd_occurrence.start_time.toFixed(2),end_time=kwd_occurrence.end_time.toFixed(2),confidence=(100*kwd_occurrence.confidence).toFixed(1),normalized_text=kwd_occurrence.normalized_text,set=keywordToHashSet(normalized_text),foundBins=scene.findBins(start_time,end_time),keywordFragments=[],binIndex=0;binIndex<foundBins.length;binIndex++)for(var bin=foundBins[binIndex],wordAlternatives=bin._wordAlternatives,waIndex=0;waIndex<wordAlternatives.length;waIndex++){var wordAlternative=wordAlternatives[waIndex],isKeyword=set[wordAlternative._text];if(isKeyword){var coordinate=[bin._index,waIndex];keywordFragments.push(coordinate)}}var onClick='"onKeywordOccurrenceSelected('+start_time+","+JSON.stringify(keywordFragments)+')"',$tr=$("<tr class='selectable' onClick="+onClick+"/>"),$td_index=$("<td class='index'>"+(index+1)+".</td>"),$td_start_label=$("<td class='bold'>Start:</td>"),$td_start=$("<td/>");$td_start.append(document.createTextNode(start_time));var $td_end_label=$("<td class='bold'>End:</td>"),$td_end=$("<td/>");$td_end.append(document.createTextNode(end_time));var $td_confidence_label=$("<td class='bold'>Confidence:</td>"),$td_confidence=$("<td/>");$td_confidence.append(document.createTextNode(confidence+"%")),$tr.append([$td_index,$td_start_label,$td_start,$td_end_label,$td_end,$td_confidence_label,$td_confidence]),$table.append($tr)}$li.append($table),$("#keywords ul").append($li)}function updateDetectedKeywords(){$("#keywords ul").empty(),keywords_to_search.forEach(function(element){var keyword=element;keyword in detected_keywords?updateKeyword(keyword):keywordNotFound(keyword)})}function toggleAlternateWords(){0==showAllHypotheses?(vslider.min<0&&$("#vslider").css("display","block"),$("#show_alternate_words").text("Hide alternate words"),showAllHypotheses=!0):($("#vslider").css("display","none"),$("#show_alternate_words").text("Show alternate words"),showAllHypotheses=!1),draw()}function updateTextScroll(){if(!scrolled){var element=$("#resultsText").get(0);element.scrollTop=element.scrollHeight}}function initTextScroll(){$("#resultsText").on("scroll",function(){textScrolled=!0})}function resetWorker(){runTimer=!1,worker.postMessage({type:"clear"}),pushed=0,popped=0,console.log("---> resetWorker called")}function showCNsKWS(bins,kws){bins.forEach(parseBin),hslider.max=scene.width()-canvas.width+INITIAL_OFFSET_X,hslider.value=hslider.max,onHScroll(),vslider.min<0&&showAllHypotheses&&$("#vslider").css("display","block"),$("#hslider").css("display","block"),$("#show_alternate_words").css("display","inline-block"),$("#canvas").css("display","block"),$("#canvas-placeholder").css("display","none"),$("#left-arrow").css("display","inline-block"),$("#right-arrow").css("display","inline-block"),parseKeywords(kws),updateDetectedKeywords()}function onTimer(){worker.postMessage({type:"shift"}),1==runTimer&&setTimeout(onTimer,timeout)}const INITIAL_OFFSET_X=30,INITIAL_OFFSET_Y=30,fontSize=16,delta_y=32,radius=5,space=4,hstep=32,timeout=500,defaultFont="16px Arial",boldFont="bold 16px Arial",italicFont="italic 16px Arial",opacity="0.6";var showAllHypotheses=!0,keywordsInputDirty=!1,keywords_to_search=[],detected_keywords={},canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),hslider=document.getElementById("hslider"),vslider=document.getElementById("vslider"),leftArrowEnabled=!1,rightArrowEnabled=!1,worker=null,runTimer=!1,scrolled=!1,textScrolled=!1,pushed=0,popped=0;ctx.font=defaultFont;var WordAlternative=function(text,confidence){"<eps>"==text?(this._text="<silence>",this._foreColor="#888"):"%HESITATION"==text?(this._text="<hesitation>",this._foreColor="#888"):(this._foreColor="#000",this._text=text),this._confidence=confidence,this._height=32,ctx.font=defaultFont,this._width=ctx.measureText(this._text+(100*this._confidence.toFixed(3)).toFixed(1)+"%").width+60,this._fillStyle="#f4f4f4",this._selectedFillStyle="#e3e3e3",this._selected=!1};WordAlternative.prototype.width=function(){return this._width},WordAlternative.prototype.height=function(){return this._height},WordAlternative.prototype.width=function(){return this._width},WordAlternative.prototype.select=function(){this._selected=!0},WordAlternative.prototype.unselect=function(){this._selected=!1},WordAlternative.prototype.draw=function(x,y,width){ctx.fillStyle=this._selected?this._selectedFillStyle:this._fillStyle,ctx.lineWidth=1,ctx.strokeStyle="#d3d3d3",ctx.fillRect(x,y,width,this.height()),ctx.strokeRect(x,y,width,this.height()),ctx.fillStyle=this._foreColor,ctx.font=this._selected?boldFont:defaultFont,ctx.fillText(this._text,x+16,y+20),ctx.font=italicFont;const appendix=(100*this._confidence.toFixed(3)).toFixed(1)+"%",rightOffset=ctx.measureText(appendix).width+32;ctx.fillText(appendix,x+16+width-rightOffset,y+20),ctx.font=defaultFont};var Bin=function(startTime,endTime){this._connectorWidth=40,this._startTime=startTime,this._endTime=endTime,this._wordAlternatives=[],this._maxWordAlternativeWidth=0,this._height=0,this._index=0};Bin.prototype.addWordAlternative=function(wa){this._wordAlternatives.push(wa);for(var index=0;index<this._wordAlternatives.length;index++){var width=this._wordAlternatives[index].width();width>this._maxWordAlternativeWidth&&(this._maxWordAlternativeWidth=width)}this._height+=wa.height()},Bin.prototype.height=function(){return this._height},Bin.prototype.width=function(){return this._maxWordAlternativeWidth+2*this._connectorWidth},Bin.prototype.draw=function(x,y){for(var index=0;index<this._wordAlternatives.length;index++){var wa=this._wordAlternatives[index];if(wa.draw(x+this._connectorWidth,y+delta_y*(index+1),this._maxWordAlternativeWidth),0==showAllHypotheses)break}ctx.moveTo(x+space+radius,y+fontSize),this._wordAlternatives.length>0&&(ctx.strokeStyle="#4178BE",ctx.lineWidth=2,ctx.lineTo(x+this.width()-9,y+fontSize),ctx.stroke())};var Scene=function(){this._bins=[],this._offset_X=INITIAL_OFFSET_X,this._offset_Y=INITIAL_OFFSET_Y,this._width=0,this._height=0,this._shift=100};Scene.prototype.draw=function(){for(var x=this._offset_X,y=this._offset_Y,last_bin_end_time=0,index=0;index<this._bins.length;index++){var bin=this._bins[index],x_visible=Math.abs(x)<=canvas.width;if(ctx.beginPath(),bin._startTime>last_bin_end_time&&(x_visible&&ctx.moveTo(x+radius+space,y+fontSize),last_bin_end_time>0&&(x+=this._shift,x_visible&&(ctx.strokeStyle="#4178BE",ctx.lineWidth=2,ctx.lineTo(x-9,y+fontSize),ctx.stroke())),x_visible)){ctx.moveTo(x+radius,y+fontSize),ctx.lineWidth=2,ctx.arc(x,y+fontSize,radius,0,2*Math.PI,!1);var start_time_caption=bin._startTime+" s",start_time_shift=ctx.measureText(start_time_caption).width/2;ctx.fillText(start_time_caption,x-start_time_shift,y),ctx.stroke()}if(x_visible){bin.draw(x,y),ctx.moveTo(x+bin.width()+radius,y+fontSize),ctx.strokeStyle="#4178BE",ctx.lineWidth=2,ctx.arc(x+bin.width(),y+fontSize,radius,0,2*Math.PI,!1),ctx.stroke();var end_time_caption=bin._endTime+" s",end_time_shift=ctx.measureText(end_time_caption).width/2;ctx.fillText(end_time_caption,x+bin.width()-end_time_shift,y),ctx.stroke()}last_bin_end_time=bin._endTime,x+=bin.width(),ctx.closePath()}},Scene.prototype.addBin=function(bin){bin._index=this._bins.length,this._bins.push(bin);for(var width=60,last_bin_end_time=0,index=0;index<this._bins.length;index++){var bin=this._bins[index];bin._startTime>last_bin_end_time&&last_bin_end_time>0&&(width+=this._shift),last_bin_end_time=bin._endTime,width+=bin.width(),this._height<bin.height()&&(this._height=bin.height(),vslider.min=canvas.height-this._height-75)}this._width=width},Scene.prototype.width=function(){return this._width+2*this._shift},Scene.prototype.height=function(){return this._height},Scene.prototype.findBins=function(start_time,end_time){for(var foundBins=[],index=0;index<this._bins.length;index++){var bin=this._bins[index],binStartTime=bin._startTime,binEndTime=bin._endTime;binStartTime>=start_time&&end_time>=binEndTime&&foundBins.push(bin)}return foundBins},Scene.prototype.startTimeToSliderValue=function(start_time){for(var last_bin_end_time=0,value=0,binIndex=0;binIndex<this._bins.length;binIndex++){var bin=this._bins[binIndex];bin._startTime<start_time&&(value+=bin.width(),bin._startTime>last_bin_end_time&&last_bin_end_time>0&&(value+=scene._shift),last_bin_end_time=bin._endTime)}return value};var scene=new Scene;$("#left-arrow").hover(function(){leftArrowEnabled?($(this).css("background-color","#C7C7C7"),$(this).css("opacity","1")):($(this).css("background-color","transparent"),$(this).css("opacity",opacity))},function(){leftArrowEnabled?$(this).css("background-color","#C7C7C7"):$(this).css("background-color","transparent"),
$(this).css("opacity",opacity)}),$("#right-arrow").hover(function(){rightArrowEnabled?($(this).css("background-color","#C7C7C7"),$(this).css("opacity","1")):($(this).css("background-color","transparent"),$(this).css("opacity",opacity))},function(){rightArrowEnabled?$(this).css("background-color","#C7C7C7"):$(this).css("background-color","transparent"),$(this).css("opacity",opacity)}),$("#left-arrow").click(function(){var updated_value=hslider.value-hstep;0>updated_value&&(updated_value=0),hslider.value=updated_value,onHScroll()}),$("#right-arrow").click(function(){var updated_value=Number(hslider.value)+hstep;updated_value>hslider.max&&(updated_value=hslider.max),hslider.value=updated_value,onHScroll()}),$("#btnLoadKWS").click(function(){$(this).find("input[type='file']").click()}),$("#btnLoadKWS input").click(function(e){e.stopPropagation()}),$("#errorWrongKeywordsFiletypeClose").click(function(){$("#error-wrong-keywords-filetype").css("display","none")}),$("#keywords ul").click(function(e){var node=void 0==e.srcElement?e.target:e.srcElement;toggleSpottedKeywordClass("keyword_text"==node.className?node.parentNode:"keyword_icon"==node.className?node.parentNode.parentNode:node)}),window.onKeywordOccurrenceSelected=function(start_time,keywordFragments){unselectLastKeyword();for(var keywordConsistsOfTopHypothesesOnly=!0,index=0;index<keywordFragments.length;index++){var fragment=keywordFragments[index],binIndex=fragment[0],waIndex=fragment[1];waIndex>0&&(keywordConsistsOfTopHypothesesOnly=!1);var bin=scene._bins[binIndex],wordAlternative=bin._wordAlternatives[waIndex];wordAlternative.select()}0==showAllHypotheses&&0==keywordConsistsOfTopHypothesesOnly&&toggleAlternateWords(),hslider.value=scene.startTimeToSliderValue(start_time),onHScroll(),$("html, body").animate({scrollTop:$("#canvas").offset().top},500)},$("#show_alternate_words").click(function(){toggleAlternateWords()}),exports.showJSON=function(baseJSON){"JSON"==$(".nav-tabs .active").text()&&$("#resultsJSON").val(baseJSON)},exports.initDisplayMetadata=function(){initTextScroll(),keywordsInputDirty=!1,hslider.min=0,hslider.max=0,hslider.value=hslider.min,vslider.min=0,vslider.max=0,vslider.value=vslider.max,$("#vslider").css("display","none"),$("#hslider").on("change mousemove",function(){onHScroll()}),$("#vslider").on("change mousemove",function(){onVScroll()}),$("#canvas").css("display","none"),$("#canvas-placeholder").css("display","block"),$("#left-arrow").css("display","none"),$("#right-arrow").css("display","none");var workerScriptBody="var fifo = [];\nvar onmessage = function(event) {\n  var payload = event.data;\n  var type = payload.type;\n  if(type == 'push') {\n    fifo.push(payload.msg);\n  }\n  else if(type == 'shift' && fifo.length > 0) {\n    var msg = fifo.shift();\n    postMessage({\n     bins:msg.results[0].word_alternatives,\n     kws:msg.results[0].keywords_result\n    });\n  }\n  else if(type == 'clear') {\n    fifo = [];\n    console.log('worker: fifo cleared');\n  }\n}\n",blobURL=window.URL.createObjectURL(new Blob([workerScriptBody]));worker=new Worker(blobURL),worker.onmessage=function(event){var data=event.data;showCNsKWS(data.bins,data.kws),popped++,console.log("----> popped",popped)}},exports.addKeyWord=function(word){addKeywordToSearch(word),keywords_to_search.length>0&&($(".keywords_title").css("display","block"),$("#keywords").css("display","block"),$("#transcription_text").css("width","55%"))},exports.showResult=function(msg,baseString,model){if(msg.results&&msg.results.length>0){var text=(msg.results[0].alternatives,msg.results[0].alternatives[0].transcript||"");if(text=text.replace(/%HESITATION\s/g,""),text=text.replace(/([^*])\1{2,}/g,""),msg.results[0]["final"]&&(console.log("-> "+text),worker.postMessage({type:"push",msg:msg}),pushed++,console.log("----> pushed",pushed),0==runTimer&&(runTimer=!0,setTimeout(onTimer,timeout))),text=text.replace(/D_[^\s]+/g,""),0==text.length||/^\s+$/.test(text))return baseString;var japanese="ja-JP"==model.substring(0,5)||"zh-CN"==model.substring(0,5);msg.results&&msg.results[0]&&msg.results[0]["final"]?(text=text.slice(0,-1),text=text.charAt(0).toUpperCase()+text.substring(1),japanese?(text=text.trim()+"。",text=text.replace(/ /g,"")):text=text.trim()+". ",baseString+=text,$("#resultsText").val(baseString)):(text=japanese?text.replace(/ /g,""):text.charAt(0).toUpperCase()+text.substring(1),$("#resultsText").val(baseString+text))}return updateTextScroll(),baseString},exports.getKeywordsToSearch=function(){return keywords_to_search},$.subscribe("clearscreen",function(){clearScene(),clearDetectedKeywords(),resetWorker()}),$(window).resize(function(){onResize()})},{}],11:[function(require,module,exports){"use strict";var handleSelectedFile=require("./fileupload").handleSelectedFile;exports.initDragDrop=function(ctx){function handleFileUploadEvent(file){handleSelectedFile(ctx.token,file)}var dragAndDropTarget=$(document);dragAndDropTarget.on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),dragAndDropTarget.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),dragAndDropTarget.on("drop",function(e){e.preventDefault();var evt=e.originalEvent;if(0!=evt.dataTransfer.files.length){var file=evt.dataTransfer.files[0];console.log("File dropped"),handleFileUploadEvent(file)}})}},{"./fileupload":13}],12:[function(require,module,exports){"use strict";exports.flashSVG=function(el){function loop(){el.animate({fill:"#A53725"},1e3,"linear").animate({fill:"white"},1e3,"linear")}el.css({fill:"#A53725"});var timer=setTimeout(loop,2e3);return timer},exports.stopFlashSVG=function(timer){el.css({fill:"white"}),clearInterval(timer)},exports.toggleImage=function(el,name){el.attr("src")==="images/"+name+".svg"?el.attr("src","images/stop-red.svg"):el.attr("src","images/stop.svg")};var restoreImage=exports.restoreImage=function(el,name){el.attr("src","images/"+name+".svg")};exports.stopToggleImage=function(timer,el,name){clearInterval(timer),restoreImage(el,name)}},{}],13:[function(require,module,exports){"use strict";var showError=require("./showerror").showError,showNotice=require("./showerror").showNotice,handleFileUpload=require("../handlefileupload").handleFileUpload,effects=require("./effects"),utils=require("../utils"),handleSelectedFile=exports.handleSelectedFile=function(){var running=!1;return localStorage.setItem("currentlyDisplaying","false"),function(token,file){function restoreUploadTab(){clearInterval(timer),effects.restoreImage(uploadImageTag,"upload"),uploadText.text("Select Audio File")}$.publish("clearscreen"),localStorage.setItem("currentlyDisplaying","fileupload"),running=!0;var uploadImageTag=$("#fileUploadTarget > img"),timer=setInterval(effects.toggleImage,750,uploadImageTag,"stop"),uploadText=$("#fileUploadTarget > span");uploadText.text("Stop Transcribing"),$.subscribe("hardsocketstop",function(){restoreUploadTab(),running=!1});var currentModel=localStorage.getItem("currentModel");console.log("currentModel",currentModel);var blobToText=new Blob([file]).slice(0,4),r=new FileReader;r.readAsText(blobToText),r.onload=function(){var contentType;if("fLaC"===r.result)contentType="audio/flac",showNotice("Notice: This browser does not support playing FLAC audio, so no audio will accompany the transcription.");else if("RIFF"===r.result){contentType="audio/wav";var audio=new Audio,wavBlob=new Blob([file],{type:"audio/wav"}),wavURL=URL.createObjectURL(wavBlob);audio.src=wavURL,audio.play(),$.subscribe("hardsocketstop",function(){audio.pause(),audio.currentTime=0})}else{if("OggS"!==r.result)return restoreUploadTab(),showError("Only WAV, FLAC, or OPUS files can be transcribed. Please try another file format."),void localStorage.setItem("currentlyDisplaying","false");contentType="audio/ogg; codecs=opus";var audio=new Audio,opusBlob=new Blob([file],{type:"audio/ogg; codecs=opus"}),opusURL=URL.createObjectURL(opusBlob);audio.src=opusURL,audio.play(),$.subscribe("hardsocketstop",function(){audio.pause(),audio.currentTime=0})}handleFileUpload("fileupload",token,currentModel,file,contentType,function(socket){var blob=new Blob([file]),parseOptions={file:blob};utils.onFileProgress(parseOptions,function(chunk){socket.send(chunk)},function(){return running?!0:!1},function(evt){console.log("Error reading file: ",evt.message),showError("Error: "+evt.message)},function(){socket.send(JSON.stringify({action:"stop"}))})},function(){effects.stopToggleImage(timer,uploadImageTag,"upload"),uploadText.text("Select Audio File"),localStorage.setItem("currentlyDisplaying","false")})}}}();exports.initFileUpload=function(ctx){var fileUploadDialog=$("#fileUploadDialog");fileUploadDialog.change(function(){var file=fileUploadDialog.get(0).files[0];handleSelectedFile(ctx.token,file)}),$("#fileUploadTarget").click(function(){var currentlyDisplaying=localStorage.getItem("currentlyDisplaying");return"fileupload"==currentlyDisplaying?(console.log("HARD SOCKET STOP"),$.publish("hardsocketstop"),void localStorage.setItem("currentlyDisplaying","false")):"sample"==currentlyDisplaying?void showError("Currently another file is playing, please stop the file or wait until it finishes"):"record"==currentlyDisplaying?void showError("Currently audio is being recorded, please stop recording before playing a sample"):(fileUploadDialog.val(null),void fileUploadDialog.trigger("click"))})}},{"../handlefileupload":3,"../utils":8,"./effects":12,"./showerror":18}],14:[function(require,module,exports){"use strict";var initAnimatePanel=require("./animatepanel").initAnimatePanel,initShowTab=require("./showtab").initShowTab,initDragDrop=require("./dragdrop").initDragDrop,initPlaySample=require("./playsample").initPlaySample,initRecordButton=require("./recordbutton").initRecordButton,initFileUpload=require("./fileupload").initFileUpload,displaymetadata=require("./displaymetadata");exports.initViews=function(ctx){console.log("Initializing views..."),initPlaySample(ctx),initDragDrop(ctx),initRecordButton(ctx),initFileUpload(ctx),initShowTab(),initAnimatePanel(),initShowTab(),displaymetadata.initDisplayMetadata(),displaymetadata.addKeyWord("big data"),displaymetadata.addKeyWord("internet of things"),displaymetadata.addKeyWord("fin tech")}},{"./animatepanel":9,"./displaymetadata":10,"./dragdrop":11,"./fileupload":13,"./playsample":15,"./recordbutton":16,"./showtab":19}],15:[function(require,module,exports){"use strict";var utils=require("../utils"),onFileProgress=utils.onFileProgress,handleFileUpload=require("../handlefileupload").handleFileUpload,getKeywordsToSearch=require("./displaymetadata").getKeywordsToSearch,showError=require("./showerror").showError,effects=require("./effects"),LOOKUP_TABLE={"ar-AR_BroadbandModel":["ar-AR_Broadband_sample1.wav","ar-AR_Broadband_sample2.wav","الطقس , رياح معتدلة","احلامنا , نستلهم"],"en-UK_BroadbandModel":["en-UK_Broadband_sample1.wav","en-UK_Broadband_sample2.wav","important industry, affordable travel, business","consumer, quality, best practice"],"en-UK_NarrowbandModel":["en-UK_Narrowband_sample1.wav","en-UK_Narrowband_sample2.wav","heavy rain, northwest, UK","Watson, sources across social media"],"en-US_BroadbandModel":["Us_English_Broadband_Sample_1.wav","Us_English_Broadband_Sample_2.wav","sense of pride, watson, technology, changing the world","round, whirling velocity, unwanted emotion"],"en-US_NarrowbandModel":["Us_English_Narrowband_Sample_1.wav","Us_English_Narrowband_Sample_2.wav","course online, four hours, help","ibm, customer experience, media data"],"es-ES_BroadbandModel":["Es_ES_spk24_16khz.wav","Es_ES_spk19_16khz.wav","quiero preguntarle, existen productos","preparando, regalos para la familia, sobrinos"],"es-ES_NarrowbandModel":["Es_ES_spk24_8khz.wav","Es_ES_spk19_8khz.wav","QUIERO PREGUNTARLE, EXISTEN PRODUCTOS","PREPARANDO, REGALOS PARA LA FAMILIA, SOBRINOS"],"ja-JP_BroadbandModel":["sample-Ja_JP-wide1.wav","sample-Ja_JP-wide2.wav","場所 , 今日","変更 , 給与 , コード"],"ja-JP_NarrowbandModel":["sample-Ja_JP-narrow3.wav","sample-Ja_JP-narrow4.wav","お客様 , お手数","申し込み , 今回 , 通帳"],"pt-BR_BroadbandModel":["pt-BR_Sample1-16KHz.wav","pt-BR_Sample2-16KHz.wav","sistema da ibm, setor bancário, qualidade, necessidades dos clientes","médicos, informações, planos de tratamento"],"pt-BR_NarrowbandModel":["pt-BR_Sample1-8KHz.wav","pt-BR_Sample2-8KHz.wav","cozinha, inovadoras receitas, criatividade","sistema, treinado por especialistas, setores diferentes"],"zh-CN_BroadbandModel":["zh-CN_sample1_for_16k.wav","zh-CN_sample2_for_16k.wav","沃 森 是 认知 , 大 数据 分析 能力","技术 , 语音 , 的 用户 体验 , 人们 , 手机"],"zh-CN_NarrowbandModel":["zh-CN_sample1_for_8k.wav","zh-CN_sample2_for_8k.wav","公司 的 支持 , 理财 计划","假期 , 安排"]},playSample=function(){var running=!1;return localStorage.setItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false"),function(token,imageTag,sampleNumber,iconName,url,keywords){$.publish("clearscreen");var currentlyDisplaying=localStorage.getItem("currentlyDisplaying"),samplePlaying=localStorage.getItem("samplePlaying");if(samplePlaying===sampleNumber)return console.log("HARD SOCKET STOP"),$.publish("socketstop"),localStorage.setItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false"),effects.stopToggleImage(timer,imageTag,iconName),effects.restoreImage(imageTag,iconName),void(running=!1);if("record"===currentlyDisplaying)return void showError("Currently audio is being recorded, please stop recording before playing a sample");if("fileupload"===currentlyDisplaying||"false"!==samplePlaying)return void showError("Currently another file is playing, please stop the file or wait until it finishes");localStorage.setItem("currentlyDisplaying","sample"),localStorage.setItem("samplePlaying",sampleNumber),running=!0,$("#resultsText").val("");var timer=setInterval(effects.toggleImage,750,imageTag,iconName),xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="blob",xhr.onload=function(){var blob=xhr.response,currentModel=localStorage.getItem("currentModel")||"en-US_BroadbandModel",reader=new FileReader,blobToText=new Blob([blob]).slice(0,4);reader.readAsText(blobToText),reader.onload=function(){var contentType="fLaC"===reader.result?"audio/flac":"audio/wav";console.log("Uploading file",reader.result);var mediaSourceURL=URL.createObjectURL(blob),audio=new Audio;audio.src=mediaSourceURL,audio.play(),$.subscribe("hardsocketstop",function(){audio.pause(),audio.currentTime=0}),$.subscribe("socketstop",function(){audio.pause(),audio.currentTime=0}),0==getKeywordsToSearch().length&&($("#tb_keywords").focus(),$("#tb_keywords").val(keywords),$("#tb_keywords").change()),handleFileUpload("sample",token,currentModel,blob,contentType,function(socket){{var parseOptions={file:blob};-1!==currentModel.indexOf("Broadband")?16e3:8e3}onFileProgress(parseOptions,function(chunk){socket.send(chunk)},function(){return running?!0:!1},function(evt){console.log("Error reading file: ",evt.message)},function(){socket.send(JSON.stringify({action:"stop"}))})},function(){effects.stopToggleImage(timer,imageTag,iconName),effects.restoreImage(imageTag,iconName),localStorage.getItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false")})}},xhr.send()}}();exports.initPlaySample=function(ctx){for(var keywords1=LOOKUP_TABLE[ctx.currentModel][2].split(","),keywords2=LOOKUP_TABLE[ctx.currentModel][3].split(","),set={},i=keywords1.length-1;i>=0;--i){var word=keywords1[i].trim();set[word]=word}for(var i=keywords2.length-1;i>=0;--i){var word=keywords2[i].trim();set[word]=word}var keywords=[];for(var word in set)keywords.push(set[word]);keywords.sort(),function(){var fileName="audio/"+LOOKUP_TABLE[ctx.currentModel][0],el=$(".play-sample-1");el.off("click");var iconName="play",imageTag=el.find("img");el.click(function(){playSample(ctx.token,imageTag,"sample-1",iconName,fileName,keywords,function(result){console.log("Play sample result",result)})})}(ctx,LOOKUP_TABLE),function(){var fileName="audio/"+LOOKUP_TABLE[ctx.currentModel][1],el=$(".play-sample-2");el.off("click");var iconName="play",imageTag=el.find("img");el.click(function(){playSample(ctx.token,imageTag,"sample-2",iconName,fileName,keywords,function(result){console.log("Play sample result",result)})})}(ctx,LOOKUP_TABLE)}},{"../handlefileupload":3,"../utils":8,"./displaymetadata":10,"./effects":12,"./showerror":18}],16:[function(require,module,exports){"use strict";var Microphone=require("../Microphone"),handleMicrophone=require("../handlemicrophone").handleMicrophone,showError=require("./showerror").showError;exports.initRecordButton=function(ctx){var recordButton=$("#recordButton");recordButton.click(function(){var running=!1,token=ctx.token,micOptions={bufferSize:ctx.buffersize},mic=new Microphone(micOptions);return function(evt){evt.preventDefault();var currentModel=localStorage.getItem("currentModel"),currentlyDisplaying=localStorage.getItem("currentlyDisplaying");return"sample"==currentlyDisplaying||"fileupload"==currentlyDisplaying?void showError("Currently another file is playing, please stop the file or wait until it finishes"):(localStorage.setItem("currentlyDisplaying","record"),void(running?(console.log("Stopping microphone, sending stop action message"),recordButton.removeAttr("style"),recordButton.find("img").attr("src","images/microphone.svg"),$.publish("hardsocketstop"),mic.stop(),running=!1,localStorage.setItem("currentlyDisplaying","false")):($("#resultsText").val(""),console.log("Not running, handleMicrophone()"),handleMicrophone(token,currentModel,mic,function(err){if(err){var msg="Error: "+err.message;console.log(msg),showError(msg),running=!1,localStorage.setItem("currentlyDisplaying","false")}else recordButton.css("background-color","#d74108"),recordButton.find("img").attr("src","images/stop.svg"),console.log("starting mic"),mic.record(),running=!0}))))}}())}},{"../Microphone":1,"../handlemicrophone":4,"./showerror":18}],17:[function(require,module,exports){"use strict";var initPlaySample=require("./playsample").initPlaySample;exports.initSelectModel=function(ctx){ctx.models.forEach(function(model){$("#dropdownMenuList").append($("<li>").attr("role","presentation").append($("<a>").attr("role","menu-item").attr("href","/").attr("data-model",model.name).append(model.description.substring(0,model.description.length-1),8e3==model.rate?" (8KHz)":" (16KHz)")))}),$("#dropdownMenuList").click(function(evt){evt.preventDefault(),evt.stopPropagation(),console.log("Change view",$(evt.target).text());var newModelDescription=$(evt.target).text(),newModel=$(evt.target).data("model");$("#dropdownMenuDefault").empty().text(newModelDescription),$("#dropdownMenu1").dropdown("toggle"),localStorage.setItem("currentModel",newModel),ctx.currentModel=newModel,initPlaySample(ctx),$("#tb_keywords").focus(),$("#tb_keywords").val(""),$("#tb_keywords").change(),$.publish("clearscreen")})}},{"./playsample":15}],18:[function(require,module,exports){"use strict";exports.showError=function(msg){console.log("Error: ",msg);var errorAlert=$(".error-row");errorAlert.hide(),errorAlert.css("background-color","#d74108"),errorAlert.css("color","white");var errorMessage=$("#errorMessage");errorMessage.text(msg),errorAlert.show(),$("#errorClose").click(function(e){return e.preventDefault(),errorAlert.hide(),!1})},exports.showNotice=function(msg){console.log("Notice: ",msg);var noticeAlert=$(".notification-row");noticeAlert.hide(),noticeAlert.css("border","2px solid #ececec"),noticeAlert.css("background-color","#f4f4f4"),noticeAlert.css("color","black");var noticeMessage=$("#notificationMessage");noticeMessage.text(msg),noticeAlert.show(),$("#notificationClose").click(function(e){return e.preventDefault(),noticeAlert.hide(),!1})},exports.hideError=function(){var errorAlert=$(".error-row");errorAlert.hide()}},{}],19:[function(require,module,exports){"use strict";exports.initShowTab=function(){$('.nav-tabs a[data-toggle="tab"]').on("shown.bs.tab",function(e){var target=$(e.target).text();"JSON"===target&&$.publish("showjson")})}},{}]},{},[5]);